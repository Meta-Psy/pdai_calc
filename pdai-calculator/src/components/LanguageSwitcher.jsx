import { useTranslation } from 'react-i18next';
import { useNavigate, useParams } from 'react-router-dom';

const languages = [
  {
    code: 'ru',
    label: 'RU',
    flag: (
      <svg viewBox="0 0 640 480" width="20" height="15" aria-hidden="true">
        <rect width="640" height="160" fill="#fff"/>
        <rect y="160" width="640" height="160" fill="#0039a6"/>
        <rect y="320" width="640" height="160" fill="#d52b1e"/>
      </svg>
    ),
  },
  {
    code: 'uz',
    label: 'UZ',
    flag: (
      <svg viewBox="0 0 640 480" width="20" height="15" aria-hidden="true">
        <rect width="640" height="160" fill="#1eb53a"/>
        <rect y="160" width="640" height="40" fill="#ce1126"/>
        <rect y="200" width="640" height="80" fill="#fff"/>
        <rect y="280" width="640" height="40" fill="#ce1126"/>
        <rect y="320" width="640" height="160" fill="#0099b5"/>
        <circle cx="100" cy="80" r="40" fill="#fff"/>
        <circle cx="115" cy="80" r="35" fill="#0099b5"/>
      </svg>
    ),
  },
  {
    code: 'en',
    label: 'EN',
    flag: (
      <svg viewBox="0 0 640 480" width="20" height="15" aria-hidden="true">
        <rect width="640" height="480" fill="#012169"/>
        <path d="M0 0l640 480M640 0L0 480" stroke="#fff" strokeWidth="60"/>
        <path d="M0 0l640 480M640 0L0 480" stroke="#C8102E" strokeWidth="40"/>
        <path d="M320 0v480M0 240h640" stroke="#fff" strokeWidth="100"/>
        <path d="M320 0v480M0 240h640" stroke="#C8102E" strokeWidth="60"/>
      </svg>
    ),
  },
  {
    code: 'kk',
    label: 'КК',
    flag: (
      <svg viewBox="0 0 640 480" width="20" height="15" aria-hidden="true">
        <rect width="640" height="160" fill="#0099b5"/>
        <rect y="160" width="640" height="40" fill="#ce1126"/>
        <rect y="200" width="640" height="80" fill="#fff"/>
        <rect y="280" width="640" height="40" fill="#ce1126"/>
        <rect y="320" width="640" height="160" fill="#1eb53a"/>
        <text x="320" y="260" textAnchor="middle" fontSize="60" fontWeight="bold" fill="#0099b5">QQ</text>
      </svg>
    ),
  },
];

export default function LanguageSwitcher() {
  const { i18n } = useTranslation();
  const navigate = useNavigate();
  const { lang } = useParams();

  const switchLang = (code) => {
    i18n.changeLanguage(code);
    navigate(`/${code}`, { replace: true });
  };

  return (
    <nav aria-label="Language switcher" className="flex gap-1">
      {languages.map(({ code, label, flag }) => (
        <button
          key={code}
          onClick={() => switchLang(code)}
          className={`flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors ${
            (lang || i18n.language) === code
              ? 'bg-indigo-100 text-indigo-700 ring-1 ring-indigo-300'
              : 'bg-gray-50 text-gray-600 hover:bg-gray-100'
          }`}
          aria-label={`Switch to ${label}`}
          aria-current={(lang || i18n.language) === code ? 'true' : undefined}
        >
          {flag}
          <span>{label}</span>
        </button>
      ))}
    </nav>
  );
}
